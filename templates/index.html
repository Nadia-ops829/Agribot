<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agribot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  {% csrf_token %}
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            eee: '#EEEEEE',
            ccc: '#BFBFBF',
          }
        }
      }
    }
  </script>
  <style>
    * { transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; }
    .fade-in { animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>

<body class="bg-white dark:bg-gray-900 min-h-screen flex flex-col">

  <!-- Bouton thème (exactement comme avant) -->
  <div class="fixed top-4 right-4 z-50">
    <button id="theme-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-300">
      <svg id="theme-icon-light" class="w-6 h-6 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
      </svg>
      <svg id="theme-icon-dark" class="w-6 h-6 text-blue-400 hidden" fill="currentColor" viewBox="0 0 20 20">
        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
      </svg>
    </button>
  </div>

  <!-- Fond + contenu centré -->
  <div class="flex-1 bg-gradient-to-tr from-eee to-neutral-200 dark:from-gray-800 dark:to-gray-900 flex flex-col">
    <div class="flex-1 overflow-y-auto px-4 pt-20 pb-32">
      <div class="w-[90%] max-w-2xl mx-auto">

        <!-- Titre exactement comme tu l’avais -->
        <div class="text-center mb-12">
          <h1 class="bg-gradient-to-r from-black via-pink-500 to-violet-800 dark:from-white dark:via-pink-400 dark:to-violet-600 inline-block text-transparent bg-clip-text font-normal text-5xl leading-tight">
            Salut je suis Agribot
          </h1><br>
          <h1 class="bg-gradient-to-r from-black via-pink-500 to-violet-800 dark:from-white dark:via-pink-400 dark:to-violet-600 inline-block text-transparent bg-clip-text font-normal text-4xl -mt-2 mb-2 leading-tight">
            Comment puis-je vous aider aujourd'hui ?
          </h1>
        </div>

        <!-- Suggestions (disparaissent quand on tape) -->
        <div id="suggestions" class="flex flex-col sm:flex-row gap-3 mb-8 text-sm text-neutral-800 dark:text-gray-300">
          <div onclick="quick(this)" class="group relative grow border border-ccc shadow-sm hover:shadow-md hover:-translate-y-[1px] hover:bg-neutral-100/30 dark:border-gray-700 dark:hover:bg-gray-800/30 rounded-xl p-4 transition-all duration-300 cursor-pointer">
            Quelle est la température idéale pour la culture des tomates ?
            <svg class="absolute right-2 bottom-2 h-4 text-neutral-500 dark:text-gray-400 opacity-0 -translate-x-4 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300" fill="currentColor" viewBox="0><path d="M2 8a.75.75 0 0 1 .75-.75h8.787L8.25 4.309a.75.75 0 0 1 1-1.118L14 7.441a.75.75 0 0 1 0 1.118l-4.75 4.25a.75.75 0 1 1-1-1.118l3.287-2.941H2.75A.75.75 0 0 1 2 8z"/></svg>
          </div>
          <div onclick="quick(this)" class="group relative grow border border-ccc shadow-sm hover:shadow-md hover:-translate-y-[1px] hover:bg-neutral-100/30 dark:border-gray-700 dark:hover:bg-gray-800/30 rounded-xl p-4 transition-all duration-300 cursor-pointer">
            Quels sont les meilleurs pratiques pour économiser l'eau en agriculture ?
            <svg class="absolute right-2 bottom-2 h-4 text-neutral-500 dark:text-gray-400 opacity-0 -translate-x-4 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300" fill="currentColor" viewBox="0 0 16 16"><path d="M2 8a.75.75 0 0 1 .75-.75h8.787L8.25 4.309a.75.75 0 0 1 1-1.118L14 7.441a.75.75 0 0 1 0 1.118l-4.75 4.25a.75.75 0 1 1-1-1.118l3.287-2.941H2.75A.75.75 0 0 1 2 8z"/></svg>
          </div>
          <div onclick="quick(this)" class="group relative grow border border-ccc shadow-sm hover:shadow-md hover:-translate-y-[1px] hover:bg-neutral-100/30 dark:border-gray-700 dark:hover:bg-gray-800/30 rounded-xl p-4 transition-all duration-300 cursor-pointer">
            Comment puis-je améliorer la fertilité de mon sol de manière naturelle ?
            <svg class="absolute right-2 bottom-2 h-4 text-neutral-500 dark:text-gray-400 opacity-0 -translate-x-4 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300" fill="currentColor" viewBox="0 0 16 16"><path d="M2 8a.75.75 0 0 1 .75-.75h8.787L8.25 4.309a.75.75 0 0 1 1-1.118L14 7.441a.75.75 0 0 1 0 1.118l-4.75 4.25a.75.75 0 1 1-1-1.118l3.287-2.941H2.75A.75.75 0 0 1 2 8z"/></svg>
          </div>
        </div>

        <!-- Zone des messages -->
        <div id="chat-messages" class="space-y-4"></div>
      </div>
    </div>

    <!-- Zone de saisie exactement comme tu l’avais (centrée) -->
    <div class="w-[90%] max-w-2xl mx-auto pb-6 px-4">
      <div class="bg-white dark:bg-gray-800 h-28 rounded-2xl shadow-md border border-neutral-200 dark:border-gray-700 relative">
        <textarea id="user-input" class="w-full h-full px-6 py-6 bg-transparent outline-none resize-none dark:text-gray-300" placeholder-gray-500" placeholder="Posez moi une question ..."></textarea>
        <button id="send-btn" class="absolute right-4 bottom-4 bg-black dark:bg-gray-700 text-white rounded-full w-10 h-10 flex items-center justify-center shadow-lg hover:shadow-xl active:scale-95">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 512 512">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M112 244l144-144l144 144M256 120v292"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <script>
    // === Thème (ton code exact) ===
    const themeToggle = document.getElementById('theme-toggle');
    const light = document.getElementById('theme-icon-light');
    const dark = document.getElementById('theme-icon-dark');
    if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
      light.classList.add('hidden');
      dark.classList.remove('hidden');
    }
    themeToggle.onclick = () => {
      document.documentElement.classList.toggle('dark');
      const isDark = document.documentElement.classList.contains('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      light.classList.toggle('hidden', isDark);
      dark.classList.toggle('hidden', !isDark);
    };

    // CSRF
    const csrftoken = document.cookie.match(/csrftoken=([^;]+)/)?.[1] || '';

    const chat = document.getElementById('chat-messages');
    const input = document.getElementById('user-input');
    const suggestions = document.getElementById('suggestions');

    function add(text, user = false) {
      const bubble = document.createElement('div');
      bubble.className = `fade-in max-w-lg px-5 py-3 rounded-2xl shadow-md ${user ? 'bg-gradient-to-r from-pink-500 to-violet-600 text-white ml-auto' : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 mr-auto'}`;
      bubble.textContent = text;
      chat.appendChild(bubble);
      chat.scrollTop = chat.scrollHeight;
    }

    async function send(msg = null) {
      const message = msg || input.value.trim();
      if (!message) return;
      if (!msg) add(message, true);
      input.value = '';
      suggestions.style.display = 'none';

      const res = await fetch('/chatbot/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded', 'X-CSRFToken': csrftoken },
        body: new URLSearchParams({ message })
      });
      const data = await res.json();
      add(data.response || "Désolé, je n’ai pas compris...");
    }

    document.getElementById('send-btn').onclick = () => send();
    input.onkeydown = e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); }};
    input.oninput = () => { if (input.value.trim()) suggestions.style.display = 'none'; };

    window.quick = el => send(el.textContent.trim());

    setTimeout(() => add("Wend na kodô ! Je suis Agribot, prêt à t’aider sur le terrain !"), 800);
  </script>
</body>
</html>